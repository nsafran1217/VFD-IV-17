/*
Library for IV-17 and IV-4 Sixteen segment alphanumeric soviet VFD tube
Nathan Safran - 9/9/2023
*/

#ifndef IV17_h
#define IV17_h
#include "Arduino.h"
class IV17
{
public:
  IV17(uint8_t dataPin, uint8_t clockPin, uint8_t latchPin, uint8_t blankPin, uint8_t numOfTubes);
  void shiftOutChar(char c, boolean latch);
  void shiftOutString(String s);
  void shiftOutCyrillicChar(const char c[], boolean latch);
  void shiftOut20Bits(uint8_t bitOrder, uint32_t val);
  void scrollString();
  void scrollStringSync();
  void setScrollingString(String s, int delay);

private:
  uint8_t _dataPin;
  uint8_t _clockPin;
  uint8_t _latchPin;
  uint8_t _blankPin;
  uint8_t _numOfTubes;
  uint8_t _scrollIndex;
  uint8_t _spaceIndex;
  int _delayToScroll;
  String _scrollingString;
  uint32_t _timeSinceLastScroll;
  uint32_t _gridPin = 0b01000000000000000000;
  const uint32_t _asciiLookupIV17[128] = {
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 

      0b00001000001010000001,  //degree symbol. ascii 0x1f
      0,  //space
      0b00100000000000001100, //!
      0b00000000001000000100, //"
      0b00001000101000111100, // #
      0b00001010101010111011, //$
      0b00001110111010011001, //%
      0b00001001001101110001, //&
      0b00000000001000000000, //'
      0b00000001010000000000, //(
      0b00000100000100000000, //)
      0b00001111111100000000, //*
      0b00001010101000000000, //+
      0b00000100000000000000, //,
      0b00001000100000000000, //-
      0b00100000000000000000, //.
      0b00000100010000000000, ///

      0b00000100010011111111, // 0
      0b00000000010000001100, // 1
      0b00001000100001110111, // 2
      0b00000000100000111111, // 3
      0b00001000100010001100, // 4
      0b00001001000010110011, // 5
      0b00001000100011111011, // 6
      0b00000000000000001111, // 7
      0b00001000100011111111, // 8
      0b00001000100010111111, // 9
      0b00000010001000000000, //:
      0b00000100001000000000, //;
      0b00000001010000000000, //<
      0b00001000100000110000, //=
      0b00000100000100000000, //>
      0b00100010100000000111, //?
      0b00000000101011110111, //@
      0b00001000100011001111, // A
      0b00000010101000111111, // B
      0b00000000000011110011, // C
      0b00000010001000111111, // D
      0b00001000000011110011, // E
      0b00001000000011000011, // F
      0b00000000100011111011, // G
      0b00001000100011001100, // H
      0b00000010001000110011, // I
      0b00000000000001111100, // J
      0b00001001010011000000, // K
      0b00000000000011110000, // L
      0b00000000010111001100, // M
      0b00000001000111001100, // N
      0b00000000000011111111, // O
      0b00001000100011000111, // P
      0b00000001000011111111, // Q
      0b00001001100011000111, // R
      0b00001000100010111011, // S
      0b00000010001000000011, // T
      0b00000000000011111100, // U
      0b00000100010011000000, // V
      0b00000101000011001100, // W
      0b00000101010100000000, // X
      0b00001000100010111100, // Y
      0b00000100010000110011, // Z
      0b00000010001000010010, //[
      0b00000001000100000000, // backslash
      0b00000010001000100001, //]
      0b00000101000000000000, //^
      0b00000000000000110000, //_
      0b00000000000100000000, //`
      0b00100010100000011000, // a
      0b00001010000011100000, // b
      0b00001000000001100000, // c
      0b00000010100000011100, // d
      0b00001100000001100000, // e
      0b00001010101000000010, // f
      0b00001010001010100001, // g
      0b00001010000011000000, // h
      0b00000010000000000000, // i
      0b00000010001001100000, // j
      0b00000011011000000000, // k
      0b00000000000011000000, // l
      0b00001010100001001000, // m
      0b00001010000001000000, // n
      0b00001010000001100000, // o
      0b00001000001011000001, // p
      0b00001010001010000001, // q
      0b00001000000001000000, // r
      0b00001010000010100001, // s
      0b00001000000011100000, // t
      0b00000010000001100000, // u
      0b00000100000001000000, // v
      0b00000101000001001000, // w
      0b00000101010100000000, // x
      0b00000000101000011100, // y
      0b00001100000000100000, // z
      0b00001010001000010010, //{
      0b00000010001000000000, //|
      0b00000010101000100001, //}
      0b00001100110000000000, //~
      0b00000000000000000000  // 
  };
  const uint32_t _cyrillicLookupIV17[32 + 16] = {
      0,
      0b00001000000011110011, // E with two dots, YO
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,

      0b00001000100011001111, // A
      0b00001000100011111011, // Б
      0b00000010101000111111, // B
      0b00000000000011000011, // Г
      0b00111000001001111110, // Д
      0b00001000000011110011, // E
      0b00001010101011001100, // Ж
      0b00000000100000111111, // З
      0b00000100010011001100, // И
      0b00000100010011001100, // Й
      0b00001001010011000000, // K
      0b00000100001000001110, // Л
      0b00000000010111001100, // M
      0b00001000100011001100, // H
      0b00000000000011111111, // O
      0b00000000000011001111, // П
      0b00001000100011000111, // P
      0b00000000000011110011, // C
      0b00000010001000000011, // T
      0b00001000100010111100, // Y
      0b00001010101010000111, // Ф
      0b00000101010100000000, // X
      0b00100000000011111100, // Ц
      0b00001000100010001100, // Ч
      0b00000010001011111100, // Ш
      0b00100010001011111100, // Щ
      0b00000010101000011001, // Ъ
      0b00001010000011101100, // Ы
      0b00001010000011100000, // Ь
      0b00001000100000111111, // Э
      0b00001010001011011110, // Ю
      0b00001100100010001111  // Я

  };
};

#endif
